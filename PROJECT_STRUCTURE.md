# 📁 Project Structure - Momentum App

Complete overview of the Momentum task management app architecture and file organization.

---

## 🏛️ Architecture Overview

This project follows **Clean Architecture** principles with three distinct layers:

```
┌─────────────────────────────────────────┐
│         Presentation Layer              │
│   (UI, Widgets, BLoC, Themes)          │
└──────────────┬──────────────────────────┘
               │
               ↓
┌─────────────────────────────────────────┐
│          Domain Layer                   │
│   (Entities, Use Cases, Interfaces)    │
└──────────────┬──────────────────────────┘
               │
               ↓
┌─────────────────────────────────────────┐
│           Data Layer                    │
│   (Models, Repositories, Data Sources)  │
└─────────────────────────────────────────┘
```

### Dependency Rule
- **Domain** layer is independent (no external dependencies)
- **Data** layer depends on **Domain**
- **Presentation** layer depends on **Domain**
- Data flows: UI → BLoC → Use Case → Repository → Data Source → Database

---

## 📂 Complete Directory Structure

```
Momentum/momentum/
│
├── lib/                                # Main source code
│   ├── core/                          # Core utilities and configuration
│   │   └── di.dart                    # Dependency Injection container
│   │
│   ├── data/                          # Data Layer - External data handling
│   │   ├── datasources/               # Data source implementations
│   │   │   └── task_local_data_source.dart
│   │   ├── models/                    # Data models (Isar schemas)
│   │   │   ├── task_model.dart
│   │   │   └── task_model.g.dart      # Generated by build_runner
│   │   ├── repositories/              # Repository implementations
│   │   │   └── task_repository_impl.dart
│   │   └── services/                  # External services
│   │
│   ├── domain/                        # Domain Layer - Business logic
│   │   ├── entities/                  # Business entities
│   │   │   └── task.dart
│   │   ├── repositories/              # Repository interfaces
│   │   │   └── task_repository.dart
│   │   └── usecases/                  # Business use cases
│   │       ├── create_task_use_case.dart
│   │       ├── delete_task_use_case.dart
│   │       ├── get_all_tasks_use_case.dart
│   │       └── update_task_use_case.dart
│   │
│   ├── presentation/                  # Presentation Layer - UI
│   │   ├── blocs/                     # State management (BLoC)
│   │   │   ├── task_bloc.dart
│   │   │   ├── task_event.dart
│   │   │   └── task_state.dart
│   │   ├── screens/                   # Full-screen pages
│   │   │   ├── create_task_page.dart
│   │   │   └── home_page.dart
│   │   ├── themes/                    # App theming
│   │   │   ├── dark_theme.dart
│   │   │   └── light_theme.dart
│   │   ├── utils/                     # UI utilities
│   │   └── widgets/                   # Reusable widgets
│   │       └── task_card.dart
│   │
│   └── main.dart                      # App entry point
│
├── assets/                            # Static assets
│   └── translations/                  # Localization files
│       ├── en.json                    # English translations
│       └── ru.json                    # Russian translations
│
├── test/                              # Test files
│   └── widget_test.dart
│
├── android/                           # Android-specific files
├── ios/                              # iOS-specific files
├── linux/                            # Linux-specific files
├── macos/                            # macOS-specific files
├── windows/                          # Windows-specific files
├── web/                              # Web-specific files
│
├── pubspec.yaml                       # Dependencies and assets
├── pubspec.lock                       # Locked dependency versions
├── analysis_options.yaml              # Linter configuration
├── README.md                          # Project documentation
├── QUICKSTART.md                      # Quick start guide
└── PROJECT_STRUCTURE.md               # This file
```

---

## 📄 File Descriptions

### Core Layer (`lib/core/`)

#### `di.dart` - Dependency Injection
- **Purpose:** Manages all app dependencies
- **Functions:**
  - Initializes Isar database
  - Creates data sources, repositories, use cases
  - Provides BLoC instances
- **Pattern:** Service Locator
- **Usage:** Called in `main.dart` before app starts

---

### Domain Layer (`lib/domain/`)

This layer contains **pure business logic** with no external dependencies.

#### `entities/task.dart`
- **Purpose:** Core business entity representing a task
- **Contains:**
  - Task properties (id, title, description, etc.)
  - TaskPriority enum (low, medium, high, urgent)
  - Business methods (copyWith)
- **Note:** Uses Equatable for value comparison

#### `repositories/task_repository.dart`
- **Purpose:** Interface defining task data operations
- **Contains:** Abstract methods for CRUD operations
- **Implementation:** In data layer (task_repository_impl.dart)

#### `usecases/`
Each use case encapsulates a single business operation:

- **`create_task_use_case.dart`** - Create new task with validation
- **`update_task_use_case.dart`** - Update existing task with validation
- **`delete_task_use_case.dart`** - Delete task by ID
- **`get_all_tasks_use_case.dart`** - Retrieve all tasks

**Pattern:** Each use case has a `call()` method that executes the operation.

---

### Data Layer (`lib/data/`)

This layer handles all data persistence and external data sources.

#### `datasources/task_local_data_source.dart`
- **Purpose:** Direct interface with Isar database
- **Operations:**
  - CRUD operations
  - Filtering (by date, priority, category)
  - Search functionality
  - Sorting and querying
- **Technology:** Isar NoSQL database

#### `models/task_model.dart`
- **Purpose:** Isar database schema definition
- **Annotations:** 
  - `@collection` - Marks as Isar collection
  - `@Index()` - Creates database index
  - `@Enumerated()` - Enum storage strategy
- **Methods:**
  - `toEntity()` - Converts to domain entity
  - `fromEntity()` - Creates from domain entity
- **Note:** Generates `task_model.g.dart` via build_runner

#### `repositories/task_repository_impl.dart`
- **Purpose:** Implements domain repository interface
- **Role:** Bridges domain and data layers
- **Converts:** Between domain entities and data models
- **Error Handling:** Wraps exceptions with meaningful messages

---

### Presentation Layer (`lib/presentation/`)

This layer contains all UI components and state management.

#### `blocs/task_bloc.dart`
- **Purpose:** Manages task-related state
- **Pattern:** BLoC (Business Logic Component)
- **Contains:**
  - Event handlers for all task operations
  - State emission logic
  - Interaction with use cases
- **Events Handled:**
  - Load, create, update, delete tasks
  - Filter, search, toggle completion
  - Batch operations

#### `blocs/task_event.dart`
- **Purpose:** Defines all possible task events
- **Events Include:**
  - LoadTasksEvent
  - CreateTaskEvent
  - UpdateTaskEvent
  - DeleteTaskEvent
  - ToggleTaskCompletionEvent
  - Filter events (by priority, category, date)
- **Pattern:** Immutable event classes using Equatable

#### `blocs/task_state.dart`
- **Purpose:** Defines all possible task states
- **States Include:**
  - TaskInitial - Before loading
  - TaskLoading - Loading in progress
  - TaskLoaded - Successfully loaded
  - TaskEmpty - No tasks found
  - TaskError - Error occurred
  - TaskOperationInProgress - Operation in progress
  - TaskOperationSuccess - Operation completed
- **Pattern:** Immutable state classes using Equatable

#### `screens/home_page.dart`
- **Purpose:** Main screen displaying task list
- **Features:**
  - Task list with filtering
  - Statistics dashboard
  - Empty state handling
  - Error state handling
  - Navigation to create/edit
- **BLoC Integration:** Uses BlocConsumer for state management

#### `screens/create_task_page.dart`
- **Purpose:** Create and edit tasks
- **Features:**
  - Form validation
  - Date/time pickers
  - Priority selection
  - Quick date presets
  - Edit mode support
- **Modes:** Create new or edit existing task

#### `widgets/task_card.dart`
- **Purpose:** Reusable task display component
- **Features:**
  - Checkbox for completion
  - Title and description
  - Due date with color coding
  - Priority indicator
  - Category badge
  - Delete button
  - Overdue highlighting
- **Actions:** Tap to edit, toggle completion, delete

#### `themes/light_theme.dart` & `dark_theme.dart`
- **Purpose:** Material 3 theme definitions
- **Contains:**
  - Color schemes
  - Component themes
  - Typography
  - Spacing and sizing
- **Support:** Automatic system theme switching

---

## 🔄 Data Flow Examples

### Creating a Task

```
1. User taps "New Task" button
   ↓
2. CreateTaskPage displays form
   ↓
3. User fills form and taps "Save"
   ↓
4. CreateTaskEvent is dispatched to TaskBloc
   ↓
5. TaskBloc calls CreateTaskUseCase
   ↓
6. Use case validates data
   ↓
7. Use case calls TaskRepository.createTask()
   ↓
8. Repository converts entity to model
   ↓
9. Repository calls TaskLocalDataSource.createTask()
   ↓
10. Data source saves to Isar database
    ↓
11. Success bubbles back up
    ↓
12. TaskBloc emits TaskOperationSuccess state
    ↓
13. UI displays success message and updates list
```

### Loading Tasks

```
1. HomePage initiates
   ↓
2. LoadTasksEvent dispatched to TaskBloc
   ↓
3. TaskBloc emits TaskLoading state
   ↓
4. TaskBloc calls GetAllTasksUseCase
   ↓
5. Use case calls TaskRepository.getAllTasks()
   ↓
6. Repository calls TaskLocalDataSource.getAllTasks()
   ↓
7. Data source queries Isar database
   ↓
8. Models converted to entities
   ↓
9. TaskBloc emits TaskLoaded state with data
   ↓
10. UI rebuilds with task list
```

---

## 🎯 Key Concepts

### 1. Clean Architecture Benefits
- **Testability:** Each layer can be tested independently
- **Maintainability:** Changes isolated to specific layers
- **Scalability:** Easy to add features
- **Independence:** Business logic separated from frameworks

### 2. BLoC Pattern
- **Separation:** UI and business logic completely separated
- **Reactive:** UI reacts to state changes
- **Testable:** Easy to test state changes
- **Predictable:** Clear state transitions

### 3. Repository Pattern
- **Abstraction:** Domain doesn't know about data sources
- **Flexibility:** Easy to swap data sources (local/remote)
- **Single Responsibility:** Each repository handles one entity

### 4. Use Case Pattern
- **Single Responsibility:** One use case = one business operation
- **Reusability:** Use cases can be composed
- **Testability:** Easy to test business rules

---

## 🔧 Development Guidelines

### Adding a New Feature

1. **Domain Layer:**
   - Create entity if needed
   - Add repository method to interface
   - Create use case

2. **Data Layer:**
   - Update model if needed
   - Add data source method
   - Implement repository method

3. **Presentation Layer:**
   - Add BLoC events
   - Add BLoC states
   - Implement event handler
   - Create/update UI

### File Naming Conventions

- **Entities:** `entity_name.dart` (e.g., `task.dart`)
- **Models:** `entity_name_model.dart` (e.g., `task_model.dart`)
- **Repositories:** `entity_name_repository.dart`
- **Use Cases:** `action_entity_use_case.dart` (e.g., `create_task_use_case.dart`)
- **BLoCs:** `entity_name_bloc.dart`, `entity_name_event.dart`, `entity_name_state.dart`
- **Screens:** `screen_name_page.dart` (e.g., `home_page.dart`)
- **Widgets:** `widget_name.dart` (e.g., `task_card.dart`)

### Code Style

- Use meaningful variable names
- Add documentation comments
- Follow Dart style guide
- Keep files under 500 lines
- Extract complex logic to separate methods

---

## 📚 Dependencies Overview

### Production Dependencies

| Package | Purpose | Layer |
|---------|---------|-------|
| flutter_bloc | State management | Presentation |
| isar | Local database | Data |
| dio | HTTP client | Data (future) |
| equatable | Value equality | All |
| intl | Date formatting | Presentation |
| path_provider | File paths | Data |
| shared_preferences | Simple storage | Data |

### Development Dependencies

| Package | Purpose |
|---------|---------|
| build_runner | Code generation |
| isar_generator | Isar schema generation |
| flutter_lints | Code quality |

---

## 🧪 Testing Strategy

### Unit Tests
- **Domain Layer:** Test use cases and entity methods
- **Data Layer:** Test repository implementations
- **Presentation Layer:** Test BLoC logic

### Widget Tests
- Test individual widgets
- Test screen layouts
- Test user interactions

### Integration Tests
- Test complete user flows
- Test data persistence
- Test navigation

---

## 🚀 Build & Deploy

### Development Build
```bash
flutter run
```

### Production Build
```bash
# Android
flutter build apk --release

# iOS
flutter build ios --release

# Desktop
flutter build macos --release
```

---

## 📝 Notes

- Always run `build_runner` after modifying Isar models
- Keep business logic in domain layer
- Use BLoC for all state management
- Follow the dependency rule strictly
- Document complex business logic
- Write tests for critical paths

---

**Last Updated:** 2024
**Version:** 1.0.0
**Architecture:** Clean Architecture + BLoC + Isar